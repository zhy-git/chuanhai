/**
 * @name jqmodal.js
 * @author ahuing
 * @link 08cms.com
 * @date 2016-09-06
 */
!function(a){function b(){var c,a=document.createElement("div"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}function f(b){return this.each(function(){var c=a(this),d=c.data("jqDrag"),f=a.extend({},e.defaults,c.data(),"object"==typeof b&&b);d||(c.data("jqDrag",d=new e(this,f)),d.init()),"string"==typeof b&&d[b]()})}function h(b,c){return this.each(function(){var d=a(this),e=d.data("jqModal"),f=a.extend({},g.defaults,d.data(),"object"==typeof b&&b);e?"string"==typeof b?e[b](c):e["toggle"]():(d.data("jqModal",e=new g(this,f)),e.init(),e.show())})}var c,d,e,g,i;a.fn.emulateTransitionEnd=function(b){var e,c=!1,d=this;return a(this).one("bsTransitionEnd",function(){c=!0}),e=function(){c||a(d).trigger(a.support.transition.end)},setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})}),c=!-[1,]&&!window.XMLHttpRequest,d=function(b,c,d){var e=a(d?c||window:"body"),f=a(window).scrollTop(),g=b.outerWidth(),h=b.outerHeight(),i=e.width(),j=e.height();return{minL:g>i?i-g:0,minT:h>j?j-h:0,maxL:g>i?0:e.width()-g,maxT:h>j?0:e.height()-h,st:f,h:h}},e=function(b,c){this.o=a.extend({},e.defaults,c),this.$self=a(b),this.$handle=this.o.handle&&this.$self.find(this.o.handle)||this.$self},e.defaults={handle:"",fixed:1,attachment:""},e.prototype.init=function(){var b=this.o,e=this.$self.css("animation-fill-mode","backwards"),f=this.$handle;f.css({cursor:"move"}).on("selectstart",function(){return!1}).on("mousedown",function(a){return e.css({opacity:b.opacity,zIndex:parseInt((new Date).getTime()/1e3)}).trigger("_mousemove",[a.pageX,a.pageY]),!1}).on("_mousemove",function(f,g,h){var n,o,i=d(e,b.attachment,b.fixed),j=e.position(),k=j.left-g,l=j.top-h;return e.trigger("dragStart",[i]),a(document).on("mousemove",function(a){a.preventDefault();var d=k+a.pageX,f=l+a.pageY;n=d<i.minL?i.minL:d>i.maxL?i.maxL:d,o=f<i.minT?i.minT:f>i.maxT?i.maxT:f,e.css({left:n,top:o+(c&&b.fixed&&i.st||0)}).trigger("drag",[n,o])}).on("mouseup",function(){a(this).off("mousemove"),e.trigger("dragEnd",[n,o])}),!1})},a.fn.jqDrag=f,g=function(b,c){this.o=c,this.Z=parseInt((new Date).getTime()/1e3),this.$self=a(b),this.isShown=!1},g.defaults={mclass:"modal",head:"",foot:"",remote:"",fixed:1,overlay:.3,drag:1,lock:0,timeout:0,css:{},headcss:{},bodycss:{},footcss:{},animate:"bounceInDown"},g.prototype={init:function(){var b=this,d=b.o,f=(d.target,'<div class="jqModal animated">    <div class="m-content m-'+d.mclass+'">'+'        <div class="m-head">'+d.head+"</div>"+'        <div class="m-body"></div>'+'        <div class="m-foot">'+d.foot+"</div>"+'        <a class="m-close" data-close="1" title="关闭" href="#"></a>'+"    </div>"+"</div>");d.overlay&&(b.$overlay=a('<div class="m-overlay"></div>').appendTo("body").css({opacity:d.overlay,zIndex:b.Z}).on("click",!d.lock&&a.proxy(b.hide,b)||a.noop)),b.$box=a(f).appendTo("body").css(a.extend({},d.css,{zIndex:b.Z,position:d.fixed&&!c&&"fixed"||"absolute"})).on("click","[data-close]",a.proxy(b.hide,b)),b.$hd=b.$box.find(".m-head").css(a.extend({},d.headcss,!d.head&&{display:"none"})),b.$bd=b.$box.find(".m-body").css(d.bodycss),b.$ft=b.$box.find(".m-foot").css(a.extend({},d.footcss,!d.foot&&{display:"none"})),c&&a("select").css("visibility","hidden"),b.$self.is("iframe")?b.$self.attr({scrolling:"no",allowtransparency:!0,frameborder:0,src:d.remote}).appendTo(this.$bd).load(function(){b.setPos(1)}):b.$bd.append(b.$self.css("display","block")),d.drag&&(b.$drag=a('<div class="jqModal-drag"></div>').insertAfter(b.$box),b.$hd.on("mousedown",function(a){b.$drag.css("display","block").trigger("_mousemove",[a.pageX,a.pageY]),d.drag>1&&b.$drag.addClass("jqModal-drag-style")}).css("cursor","move"),a(document).on("mouseup",function(){b.$drag.css("display","none"),d.drag>1&&b.$drag.removeClass("jqModal-drag-style")}),b.$drag.on(d.drag>1?"dragEnd":"drag",function(a,c,d){b.$box.css({left:c,top:d})}),c&&b.$drag.on("dragEnd",function(a,c,d){b.fixedT=d})),this.setPos(),a(document).on("keydown.modal",function(a){return 27==a.which&&b.hide(),!0}),d.fixed&&a(window).on("resize",a.proxy(b.setPos,b))},show:function(){var b=this;b.isShown||(b.$self.trigger("showFun"),b.$overlay&&b.$overlay.css("display","block"),b.$box.css("display","block"),a.support.transition&&b.$box.addClass(b.o.animate),b.$self.trigger("shownFun"),b.isShown=!0,this.o.timeout&&(clearTimeout(this.t),this.t=setTimeout(a.proxy(this.hide,this),this.o.timeout)))},hideModal:function(){this.$box.removeClass(this.o.animate+"H").hide(),this.$overlay&&this.$overlay.hide(),this.$self.trigger("hidenFun")},hide:function(b){return this.$self.trigger("hideFun"),setTimeout(a.proxy(function(){this.$box.removeClass(this.o.animate).addClass(this.o.animate+"H"),a.support.transition&&this.$box.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(500)||this.hideModal()},this),b||0),c&&(a("select").css("visibility","visible"),a(window).off("scroll.modal")),this.isShown=!1,!1},toggle:function(a){return this.isShown?this.hide(a):this.show()},setSize:function(){this.$self.is("iframe")&&this.$self.add(this.$bd).height(this.$self.css("background","none").contents().find("body").height())},setPos:function(b){var e,g;b&&this.setSize(),e=this,o=e.o,R=d(e.$box,null,o.fixed),e.fixedT=o.css.bottom>=0?R.maxT-o.css.bottom:o.css.top||(a(window).height()-R.h)/2,e.$box.css({left:o.css.right>=0?"auto":o.css.left||R.maxL/2,top:e.fixedT+((c||!o.fixed)&&R.st)}),c&&o.fixed&&(g=a(window),g.on("scroll.modal",function(){e.$box.css({top:e.fixedT+g.scrollTop()})})),o.drag&&(e.$drag[0].style.cssText=e.$box[0].style.cssText,e.$drag.css({width:e.$box.width()-6,height:e.$box.height()-6,display:""}),f.call(e.$drag,{fixed:e.o.fixed}))}},i=a.fn.jqModal,a.fn.jqModal=h,a.fn.jqModal.Constructor=g,a.fn.jqModal.noConflict=function(){return a.fn.jqModal=i,this},a(document).on("click",".btn-jqModal",function(b){var e,f,g,c=a(this),d=c.data("target")||c.attr("href");"string"==typeof d?(e=0==d.indexOf("http"),f=a(e&&'<iframe class="jqiframe"/>'||d.replace(/.*(?=#[^\s]+$)/,"")),c.data("target",f),g=a.extend({remote:e&&d},f.data(),c.data())):(f=d,g="toggle"),c.is("a")&&b.preventDefault(),h.call(f,g)}),a.jqModal={tip:function(){var b=a(".jqtip"),c=b[0]&&"show"||{mclass:"tip",animate:"shake",css:{top:100},drag:0,lock:1,timeout:arguments[2]||1500};b[0]||(b=a('<div class="jqtip"></div>')),h.call(b.html('<i class="ico ico-'+arguments[1]+'"></i>'+arguments[0]),c,arguments[2]||1500)},alert:function(b){var c=a(".jqalert"),b=c[0]&&"show"||{head:"提示信息",css:{width:300},foot:'<button data-close="1" class="ok">确定</button>'};c[0]||(c=a('<div class="jqalert"></div>')),h.call(c.html('<i class="ico ico-info"></i>'+b),b)},lay:function(b){var c=b;a(".jqlay").length?("hide"!=b&&a(".jqlay").html(c),a(".jqlay").jqModal(b)):a('<div class="jqlay">'+c+"</div>").appendTo("body").jqModal()},confirm:function(b,c){a(".jqAlert").length?"show"==b||"hide"==b||"toggle"==b?a(".jqAlert").jqModal(b):(a(".jqAlert").data("jqModal").$content.html(c),a(".jqAlert").data("jqModal").show()):h.call(a('<div class="jqAlert">'+c+"</div>").appendTo("body"),{title:b,overlay:0})}}}(jQuery);